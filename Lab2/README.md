# Лабораторная работа №2
Чан Тхи Лиен К3240
# Ход работы
## 1. Плохой Dockerfile (bad.Dockerfile)
```bash
   # Используем большой базовый образ
FROM ubuntu:latest

# Устанавливаем пакеты и обновляем систему в одной строке без очистки кеша
RUN apt-get update && apt-get install -y python3 python3-pip vim curl

# Копируем всё содержимое директории, включая ненужные файлы
COPY . /app

# Устанавливаем зависимости напрямую от root
RUN pip3 install -r /app/requirements.txt

# Запускаем контейнер от root
WORKDIR /app
CMD ["python3", "app.py"]
```
## 2. Хороший Dockerfile (good.Dockerfile)
```bash
# Используем лёгкий базовый образ
FROM python:3.10-slim

# Создаём отдельного пользователя для безопасности
RUN useradd -m appuser

# Устанавливаем зависимости только из requirements.txt и очищаем кеш apt
WORKDIR /app
COPY requirements.txt .
RUN apt-get update && apt-get install -y --no-install-recommends \
    && pip install --no-cache-dir -r requirements.txt \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Копируем только нужные файлы приложения
COPY app.py .

# Переключаемся на непривилегированного пользователя
USER appuser

CMD ["python", "app.py"]
```
## 3. Файл app.py
```bash
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello from Docker container!"

if __name__ == '__main__':
    # Для демонстрации запускаем на всех интерфейсах
    app.run(host='0.0.0.0', port=5000)
```
## 4. Файл requirements.txt
```bash
flask==3.0.3
```
## 5. Плохие практики в bad.Dockerfile
### Использование `ubuntu:latest` как базового образа
- `ubuntu:latest` — большой образ, который содержит много ненужных пакетов. Это увеличивает размер контейнера и время сборки.
- Исправлено: Использован минималистичный образ `python:3.10-slim`.
- Размер образа стал меньше, сборка — быстрее, меньше уязвимостей.
### Нет очистки кеша apt и кэша pip
- После установки пакетов остаются временные файлы и кеш, что увеличивает размер образа.
- Исправлено: После установки — `apt-get clean && rm -rf /var/lib/apt/lists/* и pip install --no-cache-dir`.
- Образ стал легче на сотни мегабайт.
### COPY . /app копирует всё подряд
- В контейнер попадают ненужные файлы (например, `.git`, тесты, временные файлы).
- Исправлено: Копируются только нужные файлы (`COPY requirements.txt` и `COPY app.py`).
- Быстрее сборка, меньше размер, меньше мусора в образе.
## 6. Плохие практики при работе с контейнерами
### Хранить данные внутри контейнера
- При удалении контейнера все данные исчезнут, нельзя будет восстановить.
- Исправлено: Использовать volumes для хранения данных (`docker volume create`, `-v /data:/app/data`).
### Запуск множества процессов в одном контейнере
- Контейнер должен выполнять одну задачу. Несколько процессов усложняют перезапуск и масштабирование.
- Исправлено: Разделять сервисы по контейнерам: база данных, API, фронтенд — каждый в своём.
## 7. Запуск проекта
```bash
docker build -f bad.Dockerfile -t bad-app .
docker run -p 5000:5000 bad-app
```
```bash
docker build -f good.Dockerfile -t good-app .
docker run -p 5000:5000 good-app
```
# Вывод
- В этой лабораторной работе показано, как выбор базового образа, порядок инструкций и настройка окружения
влияет на размер, безопасность и удобство использования контейнера.
- В результате работы были получены практические навыки по оптимизации Dockerfile и осознание важности
соблюдения принципов минимализма, безопасности и воспроизводимости при создании контейнеров.
